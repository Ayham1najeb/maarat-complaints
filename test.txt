import{c as j,r as l,u as V,a as W,j as e,b as M,X as B,d as H,e as O,z as c,f as X}from"./index-D9I4zxpp.js";import{u as Y}from"./index.esm-BE5SAkdF.js";import{C as i}from"./circle-alert-Ci1T51Di.js";import{C as G}from"./clock-BZuFMj0v.js";import{M as J}from"./map-pin-FxOBNErc.js";const K=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Q=j("check",K);const Z=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ee=j("file-exclamation-point",Z);const se=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],te=j("upload",se),oe=()=>{const[I,q]=l.useState([]),[D,E]=l.useState([]),[x,p]=l.useState([]),[y,N]=l.useState(!1),[m,v]=l.useState(!0),[L,w]=l.useState(!1),[k,_]=l.useState(""),[d,C]=l.useState(null),[n,g]=l.useState(null),[S,z]=l.useState(null),f=V(),{user:u}=W(),{register:o,handleSubmit:P,formState:{errors:t},reset:F}=Y();l.useEffect(()=>{(async()=>{v(!0);try{const[a,r]=await Promise.all([H.getAll(),O.getAll()]);q(a.data.data),E(r.data.data||[])}catch{c.error("فشل تحميل البيانات")}finally{v(!1)}})()},[]);const R=s=>{const a=Array.from(s.target.files);if(a.length+x.length>5){c.error("يمكنك رفع 5 صور كحد أقصى");return}p([...x,...a])},$=s=>{p(x.filter((a,r)=>r!==s))},A=async(s,a=!1)=>{if(!u){c.error("يجب تسجيل الدخول أولاً لتقديم شكوى"),setTimeout(()=>f("/register"),1500);return}N(!0),C(null),g(null);try{const r={...s,force_submit:!!a},h=await X.create(r);_(h.data.data.tracking_number),w(!0),c.success("تم تقديم الشكوى بنجاح!"),F(),p([]),z(null)}catch(r){console.error("Complaint submission error:",r);const h=r.response?.data?.error_type,b=r.response?.data?.message||"فشل تقديم الشكوى";h==="rate_limit_exceeded"?(C({message:b,data:r.response.data.data}),c.error(b)):h==="duplicate_complaint"?(g({message:b,existingComplaint:r.response.data.data}),z(s)):c.error(b)}finally{N(!1)}},U=()=>{S&&(A(S,!0),g(null))},T=()=>{n?.existingComplaint?.tracking_number&&f(`/track?number=${n.existingComplaint.tracking_number}`)};return L?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Q,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"تم تقديم شكواك بنجاح!"}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-xl border border-gray-200 mb-6",children:[e.jsx("p",{className:"text-gray-600 mb-3 text-sm font-medium",children:"رقم التتبع الخاص بك:"}),e.jsx("code",{className:"text-2xl font-mono font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:k})]}),e.jsx("p",{className:"text-gray-600 mb-8 text-sm leading-relaxed",children:"احتفظ بهذا الرقم لمتابعة حالة شكواك. سيتم معالجة الشكوى في أقرب وقت ممكن."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>f(`/track?number=${k}`),className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg",children:"تتبع حالة الشكوى"}),e.jsx("button",{onClick:()=>{w(!1),_("")},className:"border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-semibold py-4 px-6 rounded-xl transition-all duration-300 hover:bg-gray-50",children:"تقديم شكوى أخرى"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-12",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(i,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-4 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"تقديم شكوى جديدة"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed",children:"نظام تقديم الشكاوى الإلكتروني لمدينة معرة النعمان - إدلب"}),u&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-green-50 text-green-700 px-4 py-2 rounded-full text-sm font-medium",children:[e.jsx(M,{className:"w-4 h-4"}),"مسجل دخول كـ: ",u.name]}),!u&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-orange-50 text-orange-700 px-4 py-2 rounded-full text-sm font-medium",children:[e.jsx(i,{className:"w-4 h-4"}),"يجب تسجيل الدخول لتقديم شكوى"]})]}),d&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-8 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(G,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-red-800 mb-2",children:"تم تجاوز الحد المسموح"}),e.jsx("p",{className:"text-red-700 mb-4 leading-relaxed",children:d.message}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-red-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"عدد الشكاوى الحالي:"}),e.jsx("span",{className:"font-bold text-red-600 mr-2",children:d.data.current_count})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"الحد الأقصى:"}),e.jsx("span",{className:"font-bold text-red-600 mr-2",children:d.data.limit})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-100",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"يمكنك تقديم شكوى جديدة بعد:"}),e.jsx("p",{className:"font-bold text-red-700 mt-1",children:new Date(d.data.reset_at).toLocaleString("ar-SY")})]})]})]})]})}),n&&e.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-2xl p-6 mb-8 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(ee,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-yellow-800 mb-2",children:"تحذير: شكوى مشابهة موجودة"}),e.jsx("p",{className:"text-yellow-700 mb-4 leading-relaxed",children:n.message}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-yellow-200 mb-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"تفاصيل الشكوى السابقة:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"العنوان:"}),e.jsx("span",{className:"font-medium text-gray-800",children:n.existingComplaint.title})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"رقم التتبع:"}),e.jsx("code",{className:"font-mono font-bold text-blue-600",children:n.existingComplaint.tracking_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"الحالة:"}),e.jsx("span",{className:"font-medium text-gray-800",children:n.existingComplaint.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"التاريخ:"}),e.jsx("span",{className:"font-medium text-gray-800",children:n.existingComplaint.created_at})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"نسبة التشابه:"}),e.jsxs("span",{className:"font-bold text-yellow-600",children:[n.existingComplaint.similarity_percentage,"%"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"عرض الشكوى القديمة"}),e.jsx("button",{onClick:U,className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"المتابعة بتقديم شكوى جديدة"}),e.jsx("button",{onClick:()=>g(null),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"إلغاء"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6",children:e.jsx("h2",{className:"text-2xl font-bold text-white text-center",children:"نموذج تقديم الشكوى"})}),e.jsx("div",{className:"p-8",children:e.jsxs("form",{onSubmit:P(A),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"المعلومات الشخصية"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"الاسم الكامل *"}),e.jsx("input",{type:"text",...o("citizen_name",{required:"الاسم مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"أدخل اسمك الكامل"}),t.citizen_name&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),t.citizen_name.message]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"رقم الهاتف *"}),e.jsx("input",{type:"tel",...o("citizen_phone",{required:"رقم الهاتف مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"0933123456"}),t.citizen_phone&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),t.citizen_phone.message]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...o("citizen_email"),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"example@email.com"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:e.jsx(i,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"تفاصيل الشكوى"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"التصنيف *"}),e.jsxs("select",{...o("category_id",{required:"التصنيف مطلوب"}),disabled:m,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900 [&>option]:text-gray-900 disabled:opacity-50 disabled:cursor-wait",children:[e.jsx("option",{value:"",children:m?"جاري تحميل التصنيفات...":"اختر التصنيف"}),I.map(s=>e.jsxs("option",{value:s.id,children:[s.icon," ",s.name_ar]},s.id))]}),t.category_id&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),t.category_id.message]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"المنطقة"}),e.jsxs("select",{...o("area_id"),disabled:m,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900 [&>option]:text-gray-900 disabled:opacity-50 disabled:cursor-wait",children:[e.jsx("option",{value:"",children:m?"جاري تحميل المناطق...":"اختر المنطقة"}),D.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"العنوان *"}),e.jsx("input",{type:"text",...o("title",{required:"العنوان مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"عنوان مختصر للشكوى"}),t.title&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),t.title.message]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"الوصف التفصيلي *"}),e.jsx("textarea",{...o("description",{required:"الوصف مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white min-h-32 resize-none text-gray-900",placeholder:"اشرح المشكلة بالتفصيل..."}),t.description&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),t.description.message]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"الموقع"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"العنوان *"}),e.jsx("input",{type:"text",...o("location_address",{required:"العنوان مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"أدخل عنوان الموقع"}),t.location_address&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(i,{className:"w-4 h-4"}),t.location_address.message]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"الصور (اختياري)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"رفع الصور (حتى 5 صور)"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:R,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 bg-gray-50 hover:bg-white"})]}),x.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:x.map((s,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`Preview ${a+1}`,className:"w-full h-32 object-cover rounded-xl border-2 border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>$(a),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(B,{className:"w-4 h-4"})})]},a))})]}),e.jsx("div",{className:"pt-6",children:e.jsx("button",{type:"submit",disabled:y||!!d,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:y?"جاري الإرسال...":"تقديم الشكوى"})})]})})]})]})})};export{oe as default};
