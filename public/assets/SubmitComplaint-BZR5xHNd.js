import{c as p,r as a,u as $,a as T,j as e,b as z,d as U,e as V,z as c,f as W}from"./index-Ep9RS7kH.js";import{u as B}from"./index.esm-CPV7YYm0.js";import{C as n}from"./circle-alert-BGHbawH6.js";import{C as H}from"./clock-BCADffly.js";import{M as Y}from"./map-pin-CySHSnMK.js";const G=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],J=p("check",G);const K=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],O=p("file-exclamation-point",K);const Q=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],X=p("upload",Q),le=()=>{const[A,M]=a.useState([]),[F,q]=a.useState([]),[Z,D]=a.useState([]),[f,j]=a.useState(!1),[x,y]=a.useState(!0),[E,N]=a.useState(!1),[w,v]=a.useState(""),[o,k]=a.useState(null),[r,m]=a.useState(null),[_,C]=a.useState(null),b=$(),{user:d}=T(),{register:i,handleSubmit:I,formState:{errors:s},reset:P}=B();a.useEffect(()=>{(async()=>{y(!0);try{const[g,l]=await Promise.all([U.getAll(),V.getAll()]);M(g.data.data),q(l.data.data||[])}catch{c.error("فشل تحميل البيانات")}finally{y(!1)}})()},[]);const S=async(t,g=!1)=>{if(!d){c.error("يجب تسجيل الدخول أولاً لتقديم شكوى"),setTimeout(()=>b("/register"),1500);return}j(!0),k(null),m(null);try{const l={...t,force_submit:!!g},u=await W.create(l);v(u.data.data.tracking_number),N(!0),c.success("تم تقديم الشكوى بنجاح!"),P(),D([]),C(null)}catch(l){console.error("Complaint submission error:",l);const u=l.response?.data?.error_type,h=l.response?.data?.message||"فشل تقديم الشكوى";u==="rate_limit_exceeded"?(k({message:h,data:l.response.data.data}),c.error(h)):u==="duplicate_complaint"?(m({message:h,existingComplaint:l.response.data.data}),C(t)):c.error(h)}finally{j(!1)}},L=()=>{_&&(S(_,!0),m(null))},R=()=>{r?.existingComplaint?.tracking_number&&b(`/track?number=${r.existingComplaint.tracking_number}`)};return E?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(J,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"تم تقديم شكواك بنجاح!"}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-xl border border-gray-200 mb-6",children:[e.jsx("p",{className:"text-gray-600 mb-3 text-sm font-medium",children:"رقم التتبع الخاص بك:"}),e.jsx("code",{className:"text-lg sm:text-2xl font-mono font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent break-all block",children:w})]}),e.jsx("p",{className:"text-gray-600 mb-8 text-sm leading-relaxed",children:"احتفظ بهذا الرقم لمتابعة حالة شكواك. سيتم معالجة الشكوى في أقرب وقت ممكن."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>b(`/track?number=${w}`),className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg",children:"تتبع حالة الشكوى"}),e.jsx("button",{onClick:()=>{N(!1),v("")},className:"border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-semibold py-4 px-6 rounded-xl transition-all duration-300 hover:bg-gray-50",children:"تقديم شكوى أخرى"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-12",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(n,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-4 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"تقديم شكوى جديدة"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed",children:"نظام تقديم الشكاوى الإلكتروني لمدينة معرة النعمان - إدلب"}),d&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-green-50 text-green-700 px-4 py-2 rounded-full text-sm font-medium",children:[e.jsx(z,{className:"w-4 h-4"}),"مسجل دخول كـ: ",d.name]}),!d&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-orange-50 text-orange-700 px-4 py-2 rounded-full text-sm font-medium",children:[e.jsx(n,{className:"w-4 h-4"}),"يجب تسجيل الدخول لتقديم شكوى"]})]}),o&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-8 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(H,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-red-800 mb-2",children:"تم تجاوز الحد المسموح"}),e.jsx("p",{className:"text-red-700 mb-4 leading-relaxed",children:o.message}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-red-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"عدد الشكاوى الحالي:"}),e.jsx("span",{className:"font-bold text-red-600 mr-2",children:o.data.current_count})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"الحد الأقصى:"}),e.jsx("span",{className:"font-bold text-red-600 mr-2",children:o.data.limit})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-100",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"يمكنك تقديم شكوى جديدة بعد:"}),e.jsx("p",{className:"font-bold text-red-700 mt-1",children:new Date(o.data.reset_at).toLocaleString("ar-SY")})]})]})]})]})}),r&&e.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-2xl p-6 mb-8 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(O,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-yellow-800 mb-2",children:"تحذير: شكوى مشابهة موجودة"}),e.jsx("p",{className:"text-yellow-700 mb-4 leading-relaxed",children:r.message}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-yellow-200 mb-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"تفاصيل الشكوى السابقة:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"العنوان:"}),e.jsx("span",{className:"font-medium text-gray-800",children:r.existingComplaint.title})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"رقم التتبع:"}),e.jsx("code",{className:"font-mono font-bold text-blue-600 break-all",children:r.existingComplaint.tracking_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"الحالة:"}),e.jsx("span",{className:"font-medium text-gray-800",children:r.existingComplaint.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"التاريخ:"}),e.jsx("span",{className:"font-medium text-gray-800",children:r.existingComplaint.created_at})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"نسبة التشابه:"}),e.jsxs("span",{className:"font-bold text-yellow-600",children:[r.existingComplaint.similarity_percentage,"%"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:R,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"عرض الشكوى القديمة"}),e.jsx("button",{onClick:L,className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"المتابعة بتقديم شكوى جديدة"}),e.jsx("button",{onClick:()=>m(null),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"إلغاء"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6",children:e.jsx("h2",{className:"text-2xl font-bold text-white text-center",children:"نموذج تقديم الشكوى"})}),e.jsx("div",{className:"p-8",children:e.jsxs("form",{onSubmit:I(S),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"المعلومات الشخصية"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"الاسم الكامل *"}),e.jsx("input",{type:"text",...i("citizen_name",{required:"الاسم مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"أدخل اسمك الكامل"}),s.citizen_name&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),s.citizen_name.message]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"رقم الهاتف *"}),e.jsx("input",{type:"tel",...i("citizen_phone",{required:"رقم الهاتف مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"0933123456"}),s.citizen_phone&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),s.citizen_phone.message]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...i("citizen_email"),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"example@email.com"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:e.jsx(n,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"تفاصيل الشكوى"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"التصنيف *"}),e.jsxs("select",{...i("category_id",{required:"التصنيف مطلوب"}),disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900 [&>option]:text-gray-900 disabled:opacity-50 disabled:cursor-wait",children:[e.jsx("option",{value:"",children:x?"جاري تحميل التصنيفات...":"اختر التصنيف"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.icon," ",t.name_ar]},t.id))]}),s.category_id&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),s.category_id.message]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"المنطقة"}),e.jsxs("select",{...i("area_id"),disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900 [&>option]:text-gray-900 disabled:opacity-50 disabled:cursor-wait",children:[e.jsx("option",{value:"",children:x?"جاري تحميل المناطق...":"اختر المنطقة"}),F.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"العنوان *"}),e.jsx("input",{type:"text",...i("title",{required:"العنوان مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"عنوان مختصر للشكوى"}),s.title&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),s.title.message]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"الوصف التفصيلي *"}),e.jsx("textarea",{...i("description",{required:"الوصف مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white min-h-32 resize-none text-gray-900",placeholder:"اشرح المشكلة بالتفصيل..."}),s.description&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),s.description.message]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"الموقع"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3 font-semibold text-gray-700",children:"العنوان *"}),e.jsx("input",{type:"text",...i("location_address",{required:"العنوان مطلوب"}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-gray-50 hover:bg-white text-gray-900",placeholder:"أدخل عنوان الموقع"}),s.location_address&&e.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),s.location_address.message]})]})]}),e.jsx("div",{className:"pt-6",children:e.jsx("button",{type:"submit",disabled:f||!d,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"جاري الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-5 h-5"}),"إرسال الشكوى"]})})})]})})]})]})})};export{le as default};
